include: 
  - local: qemu-build-deploy.yml

test-qemu:
  extends: .terraform-build
  stage: test
  needs:
    - build-qemu
  environment:
    on_stop: test-qemu-cleanup
  variables:
    TF_VAR_NAME: ${NAME}
    TF_VAR_TYPE: ${TYPE}
    TF_VAR_DISTRO: ${DISTRO}
    TF_VAR_GUI_ACCESS: ${GUI_ACCESS}
    TF_VAR_ACCESS_TOKEN: ${ACCESS_TOKEN}

test-qemu-cleanup:
  extends:
    - test-qemu
    - .terraform-destroy
