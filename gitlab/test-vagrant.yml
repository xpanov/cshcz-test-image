test-vagrant:
  image: registry.gitlab.ics.muni.cz:443/muni-kypo-images/docker-image-builder/packer:latest
  stage: test
  script:
# Add 'vb.gui = false' after every 'device.vm.provider "virtualbox" do |vb|'
    - sed -i -E 's/((\s+)device\.vm\.provider\s+"virtualbox"\s+do\s+\|([^\|]+)\|)/\1\n\2  \3.gui = false/' Vagrantfile
    - vagrant up
  tags:
    - image-builder
  cache:
    key: shared-cache
    paths: 
      - .vagrant-cache/boxes
    when: always
  variables:
    VAGRANT_HOME: $CI_PROJECT_DIR/.vagrant-cache
